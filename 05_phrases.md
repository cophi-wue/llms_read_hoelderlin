---
jupyter:
  jupytext:
    formats: ipynb,md
    text_representation:
      extension: .md
      format_name: markdown
      format_version: '1.3'
      jupytext_version: 1.16.2
  kernelspec:
    display_name: ds
    language: python
    name: ds
---

# Configuration


```python
from definitions import poem_1, poem_2
import os
from utils import settings, gemini, gpt4, opus, init_gemini, printmd

%load_ext jupyter_ai_magics
```

```python
#settings
temperature = 0.8
system_prompt = "You are an expert in German literature and you are addressing other experts in German literature. You answer the questions truthfully and short."

settings(system_prompt, temperature)
```

```python
#defining aliases
init_gemini()

model =  gpt4()
%ai register gpt4o model

model = opus()
%ai register opus model 
```

# Phrases


Here we elicit interpretations of sentences or parts of sentences. We concentrate on those sentences, which have a non-obvious meaning. 'Meaning' doesn't refer here to an interpretation, but just to the question, what is the state of the fictional word described by the text. These experiments are related to the analysis of metaphorical expressions (cf. Notebook 07). 


## 1. Hälfte des Lebens (1804)

**TASK 1: General Knowledge**

The basic structure of the poem is simple. The two stanzas, representing the two "halves of life," are arranged antithetically to each other. The antithetical structure is essentially supported by four phrases or parts of sentences, namely "das Land hänget in den See", "die holden Schwäne trunken“, "die Mauern stehn sprachlos" und "im Winde klirren die Fahnen". The summer stanza portrays a harmonious landscape where everything is interconnected and alive, while the winter stanza depicts a scene of separation, silence, and lifelessness (Schmidt).

"Das Land hänget im See"

Using the phrase "Das Land hänget im See" as an example, this study aims to compare the techniques of zero-shot prompting and few-shot prompting. Zero-shot prompting refers to using a prompt to interact with the model without providing any examples or demonstrations. The zero-shot prompt directly instructs the model to perform a task without additional examples to guide it. Conversely, few-shot prompting can be employed as a technique to enable in-context learning.

This experiment seeks to explore the insight provided by Liu et al.: "LLMs do not make use of the metaphorical context well, instead relying on the predicted probability of interpretations alone [...]" (2022, p. 4438).


```python
prompt = f"""We want to understand the following poem: 

{poem_1.text}

What are possible meanings of the phrase 'Das Land hänget in den See'? Describe in each case exactly what kind of landscape this phrase renders.
"""

print(prompt)
```

Expected answer:

at least three interpretations have been discussed:
* parts of the trees and bushes are extending  over the water
* there is a small peninsula (the image is basically the view from above)
* the land with its pear tree and roses is mirrored by the water


```python
%%ai gpt4o
{prompt}
```


```python
%%ai opus
{prompt}
```


```python
printmd(gemini(prompt))
```

**"Die Mauern stehn sprachlos"**

Using the phrase 'The walls stand speechless and cold,' we investigate how different models complete clauses with the suffix 'that is to say.' 

In a first step, the models generate a completion of the sentence without the context of the poem 'Half of Life.' In the second step, the models should choose which completion fits best in the context of the poem. The output should then be ranked.

Of particular interest for us: 
By analyzing completions generated by different models, we might gain a comprehensive understanding of each model's creativity, coherence and contextual understanding. Do the models each select their "own" completion?

Prompt design:
- Generate completions (without refering to the poem), experiments with different temperatures
- Each model chooses the "best" completions for the context of the poem
- Ranking completions)
  
Expected answers (Schmidt): 
- Within the speechless walls, the nature remains silent towards the lyrical I, which was once entirely language (a whole)
- the mute 'mechanical course' of facts => through and with nature God/the divinity speaks



```python
prompt = f"""Complete the following phrase 'Die Mauern stehn sprachlos und kalt that is to say...' with a maximum length of 50 tokens.
"""
print(prompt)
```


```python
%%ai gpt4o
{prompt}
```


```python
%%ai opus
{prompt}
```


```python
printmd(gemini(prompt))
```


```python
prompt = f"""
Consider the following interpretations for the phrase 'Die Mauern stehn sprachlos und kalt that is to say...':

1. The emptiness echoes within the confines of their silence.
2. The void of communication fills the space they once occupied.
3. The air is thick with unspoken words and lingering shadows.
4. The silence screams louder than words ever could, enveloping everything in its icy grip.

You must pick one of these completions that best fits in the context of 
{poem_1.text}. 

Please also provide an elaborated rationale for why you think this interpretation is correct, a
one-word summary rationale, and a score ranking your confidence in your answer from 0 to 1.
"""

print(prompt)
```


```python
%%ai gpt4o
{prompt}
```


```python
%%ai opus
{prompt}
```


```python
printmd(gemini(prompt))
```

**TASK 2: Expert knowledge**


**"im Winde klirren die Fahnen"**

To analyze how different llms might interpret the phrase "im Winde klirren die Fahnen" based on the ambiguity of the word "Fahne" in German and English, we explore the various meanings provided and consider the contexts in which each might be used. 

Meanings of "Fahne" (Duden)
- Alkoholfahne (informal): Alcohol breath
- Printing (Druckwesen): Proof copy of a text not yet formatted into pages
- Hunting (Jägersprache): Long hair on the tails of certain hunting dogs and squirrels
- Zoology (Zoologie): Part of a bird's feather consisting of barbs on either side of the shaft
- Botany (Botanik): The uppermost petal of a butterfly flower
- Military: Service in the National People's Army of the GDR, historical use To call to arms (veraltet)

Meanings of flag (Oxford Learners Dictionaries)
- a piece of cloth with a special coloured design on it that may be the symbol of a particular country organization, may be used to give a signal or may have a particular meaning. A flag can be attached to a pole (= a long thin straight piece of wood or metal) or held in the hand.
- used to refer to a particular country or organization and its beliefs and values
- (verb) [transitive] flag something to draw attention to information that you think is important, especially by putting a special mark next to it
- (verb) [intransitive] to become tired, weaker or less enthusiastic

Prompt design
- zero-shot prompting (no context is given)
- few-shot prompting (minimal and rich context information: right and wrong context information, e.g. Add a paragraph describing a scene, such as a military parade or a hunting expedition.

Expected answers: 
- flags as weathercocks that move in the wind
- the speechlessness is interrupted by the clanging of the flags, the clanging stands for the "machine gait" of the world, and instead of the language of blossom, fruit and living being, the metal twisted by the wind sounds


```python
#zero-shot prompting
prompt = f"""
Extract the key meaning of the phrase 'im Winde klirren die Fahnen'. 
Describe in each case exactly what kind of flag this phrase renders.
""" 
print(prompt)
```


```python
%%ai gpt4o
{prompt}
```


```python
%%ai opus
{prompt}
```


```python
printmd(gemini(prompt))
```


```python
#few-shot prompting
prompt = f"""Interpret the phrase 'im Winde klirren die Fahnen'. Detect whether one of the following contexts 1-4 applies to the word "flag" in the phrase. Create a table and indicate for each context with Yes or No whether this context of use is meant. If none of the above contexts apply, please specify a new usage context

1. Military Context: Imagine a military parade where the flags of different units are clinking against their flagpoles in the wind.
2. Hunting Context: Consider a hunting expedition where the long hairs on the tails of hunting dogs are rustling in the wind.
3.Printing Context: Envision a scene in a printing house where proof copies of a text are fluttering as a breeze moves through the room.
4.Informal Context: Picture a scenario at a party where someone’s alcohol breath is noticeable as they talk in the wind.

Selecet the most probable context for {poem_1.text}. 
"""
```


```python
%%ai gpt4o
{prompt}
```


```python
%%ai opus
{prompt}
```


```python
printmd(gemini(prompt))
```

**TASK 3: Abstraktion and Transfer**


LLMs lack a multimodal horizon of experience and perception, which can be crucial for interpreting a phrase meaningfully.

New Rule of Meaning:
Only the onomatopoetic level of the phrase carries meaning

```python
prompt = f"""Read the following interpretations of example 1 and 2. Then infer the implicit rule of the following interpretation. Give an explicit formulation of that rule and apply it to the phrase "Die Mauern stehn sprachlos und kalt":

Example 1: 
Zzz… zzzit… sssschh… pling… pling is an interpretation of the poem "Kennst du das Land, wo die Zitronen blühn" (Johann Wolfgang von Goethe, Wilhelm Meisters Lehrjahre)

Zzz…
The humming sound suggests warmth and calm, evoking a sunny, Mediterranean atmosphere filled with nature. It could also represent the buzzing of insects hovering around the lemon blossoms.
Zzzit…
A sharp, delicate noise that might symbolize the blooming or unfolding of the lemon flowers. It conveys a sense of vitality and growth, almost as if the process becomes audible.
Sssschh…
A gentle rustling sound symbolizing the movement of leaves in the wind or the whisper of a soft breeze. It adds dynamism to the scene and captures the elegance of the surroundings.
Pling… pling…
These bright, light sounds evoke the image of falling water droplets or ripe lemons gently hitting the ground. They imbue the scene with a playful lightness and an acoustic dimension reminiscent of life in a vibrant garden.

Example 2

Plopp! Tap-tap! Schwupp! Tschak-tschak! Schwung! Huii! is an interpretation of the poem "Bleibe nicht am Boden heften! Frisch gewagt und frisch hinaus!" (Johann Wolfgang von Goethe, Wilhelm Meisters Wanderjahre)

Plopp!
A soft popping sound, suggesting the initial detachment from the ground. It evokes the image of something being released or breaking free with a subtle but definitive movement.
Tap-tap!
A quick, rhythmic tapping sound that illustrates the first steps forward. The repetition adds a sense of lightness and preparation, as if testing the ground for the next move.
Schwupp!
A swooshing noise, signifying a smooth, swift motion. It captures the fluidity and ease of acceleration, as if something is cutting through air or transitioning gracefully into action.
Tschak-tschak!
A sharp, deliberate sound that conveys a sense of determination and energy. It mirrors the forceful steps or actions required to build momentum, emphasizing a purposeful effort.
Schwung!
A sweeping, resonant sound representing the dynamic swing or arc of motion. It implies a sense of power and fluidity as the movement reaches its peak.
Huii!
A high-pitched, joyful sound that signifies forward propulsion and exhilaration. It embodies the playful and triumphant release of energy as the motion carries forward with enthusiasm."""
```

```python
%%ai gpt4o
{prompt}
```

```python
%%ai opus
{prompt}
```

```python
printmd(gemini(prompt))
```

## Unsere Toten (1922)


**TASK 1: General Knowledge**

```python
prompt = f"""We want to understand the following poem: 

Von Westen und Osten, von Nord und Süd schleppen sich nächtens viele Füße müd, Füße, vom Wandern wund und zerfetzt, langsam bedächtig zur Erde gesetzt, müh'n sich im zitternden Mondenschein rastlos tief nach Deutschland hinein. Und wer mit lauschendem Ohr noch wacht hört sie in jedweder werdenden Nacht, hört dies Schlurfen so müde und schwer, hört eine Klage voll wilder Begehr, eine Klage schmerzzerfressen: nur nicht vergessen! Uns nicht vergessen!

What are possible meanings of the phrase 'von Nord und Süd schleppen sich nächtens viele Füße müd,'? Describe exactly what this phrase renders.
"""

print(prompt)
```

```python
%%ai gpt4o
{prompt}
```

```python
%%ai opus
{prompt}
```

```python
printmd(gemini(prompt))
```

**TASK 2: Expert Knowledge**

The hypothesis proposed by Liu et al. (2022), which asserts that the task of associating non-figurative language with its interpretation is more challenging than the reverse, will be tested using the phrase "die Füße mühn sich im zitternden Mondenschein". 

Interpretations: 
1.  A sense of effort or struggle illuminated by the unsteady light of the moon, perhaps hinting at a journey or hard work during the night.
2.  The phrase conveys an idea of toil and perseverance despite uncertain, ever-changing circumstances, symbolized by the trembling moonlight. The feet continue their arduous journey under the unsteady light of the moon.

Of particular interest:
- Can LLM generate figurative phrases based on paraphrases or interpretations?

Prompt design
- generate a phrase with 5-10 words rephrasing or extracting the key message of this interpretation
- persona and situation modeling
- contextual understanding
- “forward” and “backward” probabilities assigned to interpretations and phrases, respectively.


```python
# Reverse interpretation and phrase

prompt = f"""Regrettably, I have just experienced a mishap. A water bottle on my desk has tipped over, rendering some documents and various texts unreadable. However, I still possess interpretations of this phrase. Generate a phrase of 5-10 words in German that corresponds to the given interpretation. The phrase and its interpretation must align.

A sense of effort or struggle illuminated by the unsteady light of the moon, perhaps hinting at a journey or hard work during the night.The phrase conveys an idea of toil and perseverance despite uncertain, ever-changing circumstances, symbolized by the moonlight. The feet continue their arduous journey under the unsteady light of the moon.

The poem is a contemporary poem entitled "Unsere Toten", which poetically reflects the experiences of First World War.""" 

```


```python
%%ai gpt4o
{prompt}
```


```python
%%ai opus
{prompt}
```


```python
printmd(gemini(prompt))
```


```python
t5 = """Von Westen und Osten, von [...] schleppen sich nächtens viele Füße müd, [...], vom Wandern
wund und zerfetzt, langsam bedächtig zur Erde gesetzt, [...]
tief nach Deutschland hinein. Und wer mit lauschendem Ohr noch wacht hört sie in jedweder werdenden
Nacht, hört dies [...] so müde und schwer, hört eine Klage voll wilder Begehr, eine Klage
schmerzzerfressen: nur nicht vergessen! Uns nicht vergessen!"""
```


```python
# Kontext Gedicht, aber mit Lücken
prompt = f"""Regrettably, I have just experienced a mishap.
A water bottle on my desk has tipped over, rendering some parts of the poem unreadable. However, a few parts of the poem are still readable. Here is the text: {t5}

Fill in the missing parts [...] in German that corresponds to the poem
"""
```


```python
%%ai gpt4o
{prompt}
```


```python
%%ai opus
{prompt}
```


```python
printmd(gemini(prompt))
```

**TASK 3: Abstraktion and Transfer**


In the poem "Unsere Toten", phrases are employed that establish an onomatopoetic dimension, such as "hört dies Schlurfen so müde und schwer" ("hears this shuffling so weary and heavy") and "hört eine Klage voll wilder Begehr, eine Klage schmerzzerfressen" ("hears a lament full of wild desire, a lament consumed by pain").

```python
prompt = f"""Read the following interpretations of example 1 and 2. Then infer the implicit rule of the following interpretation. Give an explicit formulation of that rule and apply it to the phrase "hört eine Klage voll wilder Begehr":

Example 1: 
Zzz… zzzit… sssschh… pling… pling is an interpretation of the poem "Kennst du das Land, wo die Zitronen blühn" (Johann Wolfgang von Goethe, Wilhelm Meisters Lehrjahre)

Zzz…
The humming sound suggests warmth and calm, evoking a sunny, Mediterranean atmosphere filled with nature. It could also represent the buzzing of insects hovering around the lemon blossoms.
Zzzit…
A sharp, delicate noise that might symbolize the blooming or unfolding of the lemon flowers. It conveys a sense of vitality and growth, almost as if the process becomes audible.
Sssschh…
A gentle rustling sound symbolizing the movement of leaves in the wind or the whisper of a soft breeze. It adds dynamism to the scene and captures the elegance of the surroundings.
Pling… pling…
These bright, light sounds evoke the image of falling water droplets or ripe lemons gently hitting the ground. They imbue the scene with a playful lightness and an acoustic dimension reminiscent of life in a vibrant garden.

Example 2

Plopp! Tap-tap! Schwupp! Tschak-tschak! Schwung! Huii! is an interpretation of the poem "Bleibe nicht am Boden heften! Frisch gewagt und frisch hinaus!" (Johann Wolfgang von Goethe, Wilhelm Meisters Wanderjahre)

Plopp!
A soft popping sound, suggesting the initial detachment from the ground. It evokes the image of something being released or breaking free with a subtle but definitive movement.
Tap-tap!
A quick, rhythmic tapping sound that illustrates the first steps forward. The repetition adds a sense of lightness and preparation, as if testing the ground for the next move.
Schwupp!
A swooshing noise, signifying a smooth, swift motion. It captures the fluidity and ease of acceleration, as if something is cutting through air or transitioning gracefully into action.
Tschak-tschak!
A sharp, deliberate sound that conveys a sense of determination and energy. It mirrors the forceful steps or actions required to build momentum, emphasizing a purposeful effort.
Schwung!
A sweeping, resonant sound representing the dynamic swing or arc of motion. It implies a sense of power and fluidity as the movement reaches its peak.
Huii!
A high-pitched, joyful sound that signifies forward propulsion and exhilaration. It embodies the playful and triumphant release of energy as the motion carries forward with enthusiasm."""
```

```python
%%ai gpt4o
{prompt}
```

```python
%%ai opus
{prompt}
```

```python
printmd(gemini(prompt))
```

```python

```
